---
layout: post
title:  "rust学习笔记"
categories: rust
tags:  rust
author: malefo
---

* content
{:toc}

## *前言*

我是怎么接触rust的呢，想想好像是在19年底的时候，一个同事和我说:“你知道rust吗？巨吊，没有gc。”。我当时只是左耳进右耳出。
后面新冠爆发，在家办公，看了一点区块链的东西，然后想到了facebook的libra，看到libra是用rust实现的，突然一下想到rust还在哪里听到过。
一下子醒悟了，这是之前同事说的东西，然后开始进行了解，学习。

这段时间刚好离职了，离去下份工作入职还有差不多半个月的时间，有了些时间，更新一下博客，同时给自己进行一个学习总结和充电。

<!-- more -->

## *索引*
***

* [学习回顾](#学习回顾)

* [制定目标](#制定目标)

* [实现目标](#实现目标)

***

## *正文*

##### 学习回顾

真正开始学习是从四月份开始，那时候闲了下来，上家公司好像因为财务问题即将GG，项目少了很多很多。
时间空了出来，同时老同学说他自己的公司经常7月份要报表10月份才出得来，因为数据收集问题，统计问题等等，
于是乎开始给他进行开发，开发一个报表管理系统，技术使用java+vue，vue是别人来搞，我负责后台和运维，
搭建服务器，搭建代码管理gitlab，搭建自动化部署工具jenkins，由于就两个服务，就不上k8s了，大体就这些。

刚开始拿自己的主机装ubuntu server来做的服务器，淘宝搞了一个内网映射的工具，但是卡的不行啊，果断放弃选用阿里云。
然后开始紧密锣鼓的搭建，部署，开发。
在这之中我选用了java的异步web开发，但是我们要保存数据的要用到数据库，我看数据库，mysql没有异步的，mongodb有，就选用了mongodb，
这里为什么我要去看看数据库是否支持异步呢？举个例子

>老张爱喝茶，废话不说，煮开水。
 出场人物：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。
 1 老张把水壶放到火上，立等水开。（同步阻塞）
 老张觉得自己有点傻
 2 老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有。（同步非阻塞）
 老张还是觉得自己有点傻，于是变高端了，买了把会响笛的那种水壶。水开之后，能大声发出嘀~~~~的噪音。
 3 老张把响水壶放到火上，立等水开。（异步阻塞）
 老张觉得这样傻等意义不大
 4 老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）
 老张觉得自己聪明了。
 所谓同步异步，只是对于水壶而言。
 普通水壶，同步；响水壶，异步。
 虽然都能干活，但响水壶可以在自己完工之后，提示老张水开了。这是普通水壶所不能及的。
 同步只能让调用者去轮询自己（情况2中），造成老张效率的低下。
 所谓阻塞非阻塞，仅仅对于老张而言。
 立等的老张，阻塞；看电视的老张，非阻塞。
 情况1和情况3中老张就是阻塞的，媳妇喊他都不知道。虽然3中响水壶是异步的，可对于立等的老张没有太大的意义。所以一般异步是配合非阻塞使用的，这样才能发挥异步的效用

异步就是相对于调用方，被调用方要能主动通知，因此我web使用的是异步，我去调用数据库，数据库成了被调用方，如果他不支持异步，那不一样变成了同步阻塞。

在使用java异步开发有个很有意思的地方，不在是同步获取，判断是否有数据；现在是基于流的感念，通过api去处理抽象的数据--数据流。

很快就把这个系统的java版本写完了，然后开始用go进行了一遍重构，看到go没有mongodb的异步框架，就不写了，
虽然go本身就是异步形式的，但是mongodb不是异步的，不一样编程同步阻塞了；不过在编码层可以规避这样的同步阻塞，直接新启一个go程就好。

既然很闲，就开始了rust的研究之路，这一路便是对知识的不停探索。

>了解一遍基本语法

这个过程我使用了两周去看网上的文档，有了一个对语法的初步认识，记住了一些关键字，字符串String，字符串的字面量&str，可变数组Vec等等，
记住这些常用的关键字可方便你在后面遇到不懂的时候直接百度用法写法，因为这些都是最常用的。

然后开始知道rust中文社区rust.cc，开始每天逛逛论坛，看看别人的学习笔记。

这时候我犯了一个错误，*刷题*，然后被链表的只能指针搞得晕头转向，用了几天缓过来，继续向下学习。
这时候收到了挫折，因为确实这个语言的学习曲线是比较复杂的，设计者不适用gc，直接把变量的逃逸分析搬到了编码层，你在写代码的时候就要明白变量的去处和使用。

这时候的我又犯了另外一个错误，拿公司项目进行重构，由于对各种基础知识都掌握不够的情况下，开始各种找包来使用，为了能便宜通过，也不知道自己写的代码的意思，
最后编译通过了，产生了运行时错误，又搜不到类似的问题答案，直接导致我放弃学习一个月多。

后面鬼使神差又学了起来，买了张汉东的《rust编程之道》，然后开始去做了一堆例子，算是把基础的东西大体记住了。
自此，开始对自己的项目进行了重构，这次我选择一点点的前进，搞明白我为什么要这么写，搞明白每一句话的含义，遇到不懂就查，
之后就像拨云见日一样，一切都很明朗，就算编译不过也能清楚怎么回事了。那种感觉很棒。

后面进了群，看到大家都在说异步的东西，然后看了一下招聘的信息也要使用异步的知识，这时候开启了rust的第二段旅程。
这段旅程让我对rust，go，java这三者的优缺点还有各自对异步的支持模式都有了一个大体的了解。

rust的异步使用的是无栈协程，使用异步就是为了解决c10k的问题，用单线程或者少量的线程去解决高并发。